name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build-windows-installers:
    runs-on: windows-latest
    name: Build Windows Installers
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install backend dependencies
      run: npm ci
    
    - name: Install frontend dependencies
      working-directory: ./client
      run: npm ci
    
    - name: Build frontend
      working-directory: ./client
      run: npm run build
      
    - name: Build Electron installers
      run: npm run electron:build:nsis
    
    - name: Create Release and Upload Assets
      uses: softprops/action-gh-release@v2
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        name: MyRadiko ${{ github.ref_name }}
        body: |
          # MyRadiko ${{ github.ref_name }} - Windows Desktop Application
          
          radikoã®ç•ªçµ„ã‚’éŒ²éŸ³ãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã®Windowsç”¨ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚
          
          ## ğŸ“¦ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          
          **æ¨å¥¨**: NSISã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ï¼ˆ`MyRadiko-Setup-${{ github.ref_name }}.exe`ï¼‰
          - æ¨™æº–çš„ãªWindowsã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ï¼ˆäº‹å‰ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ï¼‰
          - ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè‡ªå‹•ä½œæˆ
          - ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ç™»éŒ²
          - ç°¡å˜ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          
          ## âœ¨ ä¸»è¦æ©Ÿèƒ½
          - ğŸ“» ç•ªçµ„è¡¨è¡¨ç¤ºï¼ˆ1é€±é–“å…ˆã¾ã§ï¼‰
          - ğŸµ éŒ²éŸ³äºˆç´„ã‚·ã‚¹ãƒ†ãƒ 
          - ğŸ“… äºˆç´„ç®¡ç†ï¼ˆç¹°ã‚Šè¿”ã—äºˆç´„å¯¾å¿œï¼‰
          - ğŸ§ ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ»å†ç”Ÿ
          - âš™ï¸ è©³ç´°è¨­å®šã‚·ã‚¹ãƒ†ãƒ 
          - ğŸ“‹ ãƒ­ã‚°ãƒ»å±¥æ­´ç®¡ç†
          
          ## ğŸš€ ä½¿ç”¨æ–¹æ³•
          1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          3. ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã¾ãŸã¯ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰èµ·å‹•
          
          ## âš ï¸ æ³¨æ„äº‹é …
          - Windows 10/11 (64bit) å°‚ç”¨
          - radikoã®åˆ©ç”¨è¦ç´„ã«å¾“ã£ã¦ã”ä½¿ç”¨ãã ã•ã„
          - å€‹äººåˆ©ç”¨ç›®çš„ã®ã¿
        files: |
          ./dist-electron/MyRadiko Setup 1.0.0.exe
        draft: false
        prerelease: false